# AFM Corrosion Pit Tracker

This project provides interactive tools for identifying and tracking corrosion pits in AFM image sequences.

## Running the tool

```bash
python main.py
```

You will be prompted to select a directory containing grayscale PNG AFM images. Once loaded, the interactive viewer exposes a number of tools for curating pit contours.

## Key features

- Add, select, and manually sketch pit contours.
- Automatic refinement routines including refitting and auto-similar detection.
- Frame-to-frame tracking with drift correction.
- **Align Edge** tool to snap the selected pit boundary to the strongest nearby slope.
- Export of annotated frames and optional corrosion rate summaries.

## Code structure

- `main.py`: entry point that boots the interactive application.
- `afm_tracker/loader.py`: image loading and metadata extraction.
- `afm_tracker/detection.py`: pit boundary detection and auto-similar search utilities.
- `afm_tracker/tracking.py`: drift correction and cross-frame pit assignment.
- `afm_tracker/profile.py`: contour-based pit feature extraction.
- `afm_tracker/alignment.py`: gradient-based contour alignment helpers.
- `afm_tracker/utils.py`: shared geometry and mask utilities.
- `afm_tracker/gui.py`: the main `SmartPitTracker` GUI class tying everything together.

## Requirements

The scripts rely on NumPy, OpenCV, Matplotlib, scikit-image, SciPy, and pandas.

## Batch pit growth analysis

For automated, non-interactive processing of AFM pit growth across an image sequence use:

```bash
python analyze_pit_growth.py /path/to/afm/pngs \
    --min-area-nm2 5e4 \
    --max-match-distance 35
```

The script detects corrosion pits in each frame, tracks them over time, and writes:

- `pit_growth_outputs/pit_observations.csv`: per-frame pit measurements (area, depth, centroid, etc.).
- `pit_growth_outputs/pit_growth_summary.csv`: per-pit growth statistics including corrosion metrics.
- `pit_growth_outputs/pit_growth_summary.xlsx`: Excel workbook duplicating the corrosion summary with pit perimeters (nm), young pit areas (px), pixel-to-nmÂ² conversion factor, and corrosion rates.
- `pit_growth_outputs/frame_XXX_overlay.png`: visual overlays showing detected pits and their IDs for each frame.

Use the `--min-area-nm2` flag when the image filenames encode a physical pixel scale (e.g., `250nm`). Otherwise the `--min-area-px` threshold is applied in pixel units.
